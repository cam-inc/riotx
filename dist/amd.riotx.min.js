define(["riot"],function(r){"use strict";var e="2.0.3";r=r&&r.hasOwnProperty("default")?r["default"]:r;function t(t,e,n){if(t==null){return}var r=-1,i=t.length;while(++r<i){if(e.call(n,t[r],r,t)===false){break}}}var u=t;function n(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var s=n;var f,c;function l(){c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"];f=true;for(var t in{toString:null}){f=false}}function i(t,e,n){var r,i=0;if(f==null){l()}for(r in t){if(h(e,t,r,n)===false){break}}if(f){var o=t.constructor,a=!!o&&t===o.prototype;while(r=c[i++]){if((r!=="constructor"||!a&&s(t,r))&&t[r]!==Object.prototype[r]){if(h(e,t,r,n)===false){break}}}}}function h(t,e,n,r){return t.call(r,e[n],n,e)}var o=i;function a(n,r,i){o(n,function(t,e){if(s(n,e)){return r.call(i,n[e],e,n)}})}var p=a;var d=Object.keys||function(t){var n=[];p(t,function(t,e){n.push(e)});return n};var v=d;function g(t){return Object.prototype.toString.call(t).slice(8,-1)}var y=g;function m(t,e){return y(t)===e}var _=m;function w(t){return _(t,"Function")}var b=w;function j(t){return _(t,"Object")}var x=j;var T=setTimeout;function O(){}function P(t,e){return function(){t.apply(e,arguments)}}function E(t){if(!(this instanceof E)){throw new TypeError("Promises must be constructed via new")}if(typeof t!=="function"){throw new TypeError("not a function")}this._state=0;this._handled=false;this._value=undefined;this._deferreds=[];k(t,this)}function F(n,r){while(n._state===3){n=n._value}if(n._state===0){n._deferreds.push(r);return}n._handled=true;E._immediateFn(function(){var t=n._state===1?r.onFulfilled:r.onRejected;if(t===null){(n._state===1?R:N)(r.promise,n._value);return}var e;try{e=t(n._value)}catch(t){N(r.promise,t);return}R(r.promise,e)})}function R(e,t){try{if(t===e){throw new TypeError("A promise cannot be resolved with itself.")}if(t&&(typeof t==="object"||typeof t==="function")){var n=t.then;if(t instanceof E){e._state=3;e._value=t;B(e);return}else if(typeof n==="function"){k(P(n,t),e);return}}e._state=1;e._value=t;B(e)}catch(t){N(e,t)}}function N(t,e){t._state=2;t._value=e;B(t)}function B(t){if(t._state===2&&t._deferreds.length===0){E._immediateFn(function(){if(!t._handled){E._unhandledRejectionFn(t._value)}})}for(var e=0,n=t._deferreds.length;e<n;e++){F(t,t._deferreds[e])}t._deferreds=null}function S(t,e,n){this.onFulfilled=typeof t==="function"?t:null;this.onRejected=typeof e==="function"?e:null;this.promise=n}function k(t,e){var n=false;try{t(function(t){if(n){return}n=true;R(e,t)},function(t){if(n){return}n=true;N(e,t)})}catch(t){if(n){return}n=true;N(e,t)}}E.prototype["catch"]=function(t){return this.then(null,t)};E.prototype.then=function(t,e){var n=new this.constructor(O);F(this,new S(t,e,n));return n};E.prototype["finally"]=function(e){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){return n.reject(t)})})};E.all=function(e){return new E(function(r,i){if(!e||typeof e.length==="undefined"){throw new TypeError("Promise.all accepts an array")}var o=Array.prototype.slice.call(e);if(o.length===0){return r([])}var a=o.length;function u(e,t){try{if(t&&(typeof t==="object"||typeof t==="function")){var n=t.then;if(typeof n==="function"){n.call(t,function(t){u(e,t)},i);return}}o[e]=t;if(--a===0){r(o)}}catch(t){i(t)}}for(var t=0;t<o.length;t++){u(t,o[t])}})};E.resolve=function(e){if(e&&typeof e==="object"&&e.constructor===E){return e}return new E(function(t){t(e)})};E.reject=function(n){return new E(function(t,e){e(n)})};E.race=function(i){return new E(function(t,e){for(var n=0,r=i.length;n<r;n++){i[n].then(t,e)}})};E._immediateFn=typeof setImmediate==="function"&&function(t){setImmediate(t)}||function(t){T(t,0)};E._unhandledRejectionFn=function t(e){if(typeof console!=="undefined"&&console){console.warn("Possible Unhandled Promise Rejection:",e)}};var D=function(t){var e=[],n=arguments.length-1;while(n-- >0)e[n]=arguments[n+1];e.unshift("[riotx]");try{console.log.apply(console,e)}catch(t){console.log(e)}};var I={debug:false,default:"@",changeBindName:"riotxChange",strict:false,logger:{output:D}};var A=function(){var t=[],e=arguments.length;while(e--)t[e]=arguments[e];if(!I.debug){return}t.unshift("DEBUG");I.logger.output.apply(null,t)};var C=function(t){var e=new Error("[riotx] "+t);I.logger.output.apply(null,["ERROR",e]);throw e};var U=function t(e){var n=this;this.name=e.name;if(!this.name){this.name=I.default;A("Default store name. name="+this.name)}this._state=e.state;Object.defineProperty(this,"state",{get:function(){if(I.strict){C("[strict] Direct access get error.")}return n._state},set:function(t){if(I.strict){C("[strict] Direct access set error. "+t)}n._state=t}});this._actions=e.actions;this._mutations=e.mutations;this._getters=e.getters;this._plugins=e.plugins;r.observable(this);u(this._plugins,function(t){if(!b(t)){C("[plugin] The plugin is not a function.")}t.apply(null,[n])})};U.prototype.reset=function t(){this.name=null;this._state=null;this._actions=null;this._mutations=null;this._getters=null;this._plugins=null;this.off("*")};U.prototype.getter=function t(e,n){if(n&&!x(n)){C("[getter]', 'The getter data is not object type. name="+e+" data="+n)}var r={state:this._state};var i=this._getters[e];if(!i||typeof i!=="function"){C("[getter]', 'The getter is not a function. name="+e+" data="+n)}A("[getter]",e,n);return i.apply(null,[r,n])};U.prototype.commit=function t(e,n){var r=this;if(n&&!x(n)){C("[mutation]', 'The mutation data is not object type. name="+e+" data="+n)}var i={getter:function(t,e){return r.getter.apply(r,[t,e])},state:this._state};var o=this._mutations[e];if(!o||typeof o!=="function"){C("[mutation]', 'The mutation is not a function. name="+e+" data="+n)}A("[mutation(before)]",e,this._state,n);var a=o.apply(null,[i,n]);A("[mutation(after)]",e,this._state,n);this.trigger("riotx:mutations:after",e,a,i,n);u(a,function(t){r.trigger(t,r._state,r)})};U.prototype.action=function t(e,n){var r=this;if(n&&!x(n)){C("[action]', 'The action data is not object type. name="+e+" data="+n)}var i={getter:function(t,e){return r.getter.apply(r,[t,e])},commit:function(t,e){r.commit(t,e)}};var o=this._actions[e];if(!o||typeof o!=="function"){C("[action] The action is not a function. name="+e+" data="+n)}A("[action]",e,n);return E.resolve().then(function(){return o.apply(null,[i,n])})};U.prototype.change=function t(){var e;var n=[],r=arguments.length;while(r--)n[r]=arguments[r];(e=this).on.apply(e,n)};var z=function t(){this.version=e||"";this.Store=U;this.stores={};var n=function(t,e,n){var r=[],i=arguments.length-3;while(i-- >0)r[i]=arguments[i+3];this._riotx_change_handlers.push({store:t,evtName:e,handler:n});r.unshift(n);r.unshift(e);t.change.apply(t,r)};r.mixin({init:function(){var e=this;this.on("unmount",function(){e.off("*");u(e._riotx_change_handlers,function(t){t.store.off(t.evtName,t.handler)});delete e.riotx;delete e._riotx_change_handlers;delete e[I.changeBindName]});if(I.debug){this.on("*",function(t){A("[riot.mixin]",t,e)})}this._riotx_change_handlers=[];this[I.changeBindName]=n},riotx:this})};z.prototype.add=function t(e){if(this.stores[e.name]){C("[store.add] The store instance named `"+e.name+"` already exists.")}this.stores[e.name]=e;return this};z.prototype.get=function t(e){if(e===void 0)e=I.default;return this.stores[e]};z.prototype.debug=function t(e){I.debug=!!e;return this};z.prototype.setChangeBindName=function t(e){I.changeBindName=e;return this};z.prototype.strict=function t(e){I.strict=!!e;return this};z.prototype.logger=function t(e){I.logger.output=e;return this};z.prototype.reset=function t(){p(this.stores||{},function(t){t.reset()});this.stores={};return this};z.prototype.size=function t(){return v(this.stores).length};var G=new z;return G});